!function(root){function loadJs(url,ignoreDuplicate,cb){if(ignoreDuplicate&&loadedRes[url])return void(cb&&cb());if(ignoreDuplicate&&loadingRes[url])return void loadingRes[url].push(cb);loadingRes[url]=loadingRes[url]||[];var script=d.createElement("script"),loaded=!1,wrap=function(){if(!loaded){if(loaded=!0,loadedRes[url]=!0,ignoreDuplicate){for(var i=0;i<loadingRes[url].length;i++)loadingRes[url][i]&&loadingRes[url][i]();loadingRes[url]=null}cb&&cb()}};script.setAttribute("src",url),script.setAttribute("type","text/javascript"),script.onload=script.onerror=wrap,script.onreadystatechange=wrap,head.appendChild(script)}function loadCss(url,ignoreDuplicate,cb){if(ignoreDuplicate&&loadedRes[url])return void(cb&&cb());if(ignoreDuplicate&&loadingRes[url])return void loadingRes[url].push(cb);loadingRes[url]=loadingRes[url]||[];var link=d.createElement("link");link.type="text/css",link.rel="stylesheet",link.href=url,"msie"===browser?link.onreadystatechange=function(){/loaded|complete/.test(link.readyState)&&cb()}:"opera"===browser?link.onload=cb:!function(){try{link.sheet.cssRule}catch(e){return void setTimeout(arguments.callee,20)}if(loadedRes[url]=!0,ignoreDuplicate){for(var i=0;i<loadingRes[url].length;i++)loadingRes[url][i]&&loadingRes[url][i]();loadingRes[url]=null}cb()}(),head.appendChild(link)}function globalEval(code){var script;code=code.replace(/^\s+/,"").replace(/\s+$/,""),code&&(1===code.indexOf("use strict")?(script=document.createElement("script"),script.text=code,head.appendChild(script).parentNode.removeChild(script)):eval(code))}function saveLoadedRes(){function addRes(url){url&&(loadedRes[url]=!0,0===url.indexOf(domain)&&(loadedRes[url.replace(domain,"")]=!0))}for(var domain=window.location.protocol+"//"+window.location.host,scripts=document.getElementsByTagName("script"),links=document.getElementsByTagName("link"),i=0;i<scripts.length;i++)addRes(scripts[i].src);for(var j=0;j<links.length;j++)addRes(links[j].href)}function appendStyle(code){var dom=document.createElement("style");dom.innerHTML=code,head.appendChild(dom)}function ajax(url,cb,data){var xhr=new(window.XMLHttpRequest||ActiveXObject)("Microsoft.XMLHTTP");xhr.onreadystatechange=function(){4==this.readyState&&(200!==this.status?cb(this.responseText):cb(null,this.responseText))},xhr.open(data?"POST":"GET",url+"&t="+(new Date).getTime(),!0),data&&xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.send(data)}function mixin(a,b){if(a&&b)for(var k in b)b.hasOwnProperty(k)&&(a[k]=b[k]);return a}var d=document,head=d.getElementsByTagName("head")[0],loadedRes={},loadingRes={},browser=function(){var ua=navigator.userAgent.toLowerCase(),match=/(webkit)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version)?[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||!/compatible/.test(ua)&&/(mozilla)(?:.*? rv:([\w.]+))?/.exec(ua)||[];return match[1]}(),Util={loadJs:loadJs,loadCss:loadCss,appendStyle:appendStyle,globalEval:globalEval,saveLoadedRes:saveLoadedRes,ajax:ajax,mixin:mixin};root.BigPipeUtil=Util}(this),function(root){function findHandlers(arr,name,callback){var ret=[];return each(arr,function(handler){!handler||name&&handler.e!==name||callback&&handler.cb!==callback&&handler.cb._cb!==callback||ret.push(handler)}),ret}function each(arr,iterator){for(var item,i=0,len=arr.length;len>i;i++)item=arr[i],iterator.call(item,item,i)}function triggerHanders(events,args){for(var handler,i=-1,len=events.length;++i<len&&(handler=events[i],handler.cb.apply(handler.ctx,args)!==!1););}var protos,Util=root.BigPipeUtil,slice=[].slice;protos={on:function(name,callback){var set;return set=this._events||(this._events=[]),set.push({e:name,cb:callback,id:set.length,ctx:this}),this},once:function once(name,callback){var once,me=this;return once=function(){return me.off(name,once),callback.apply(me,arguments)},once._cb=callback,me.on(name,once)},off:function(name,cb){var events=this._events;return name||cb?(each(findHandlers(events,name,cb),function(item){delete events[item.id]}),this):(this._events=[],this)},trigger:function(type){var args,events;return this._events&&type?(args=slice.call(arguments,1),events=findHandlers(this._events,type),triggerHanders(events,args)):this}},root.BigPipeEvent=Util.mixin({mixto:function(obj){return Util.mixin(obj,protos)}},protos)}(this),function(root){var Util=root.BigPipeUtil,Event=root.BigPipeEvent,BigPipe=function(){function PageLet(data,onDomInserted){var remaining=0,item={cssLoaded:!1,finish:function(){insertDom(data)}},loadCss=function(){if(insertQueue.push(item),data.css&&data.css.length){remaining=data.css.length;for(var i=0,len=remaining;len>i;i++)Util.loadCss(data.css[i],BigPipe.ignoreDuplicate,function(){--remaining,0===remaining&&(item.cssLoaded=!0,finishInsertQueue())})}else item.cssLoaded=!0,finishInsertQueue()},finishInsertQueue=function(){for(var item=insertQueue[0];item&&item.cssLoaded;)insertQueue.shift(),item.finish(),item=insertQueue[0]},insertDom=function(){var i,len,dom,temp;if(data.styles&&data.styles.length)for(i=0,len=data.styles.length;len>i;i++)Util.appendStyle(data.styles[i]);if(dom=data.container&&"string"==typeof data.container?document.getElementById(data.container):data.container||document.getElementById(data.id),data.extend)for(temp=document.createElement("div"),temp.innerHTML=data.html;temp.firstChild;)dom.appendChild(temp.firstChild);else dom.innerHTML=data.html;setTimeout(function(){onDomInserted(data)},0)},loadJs=function(callback){var i,len=data.js&&data.js.length,remaining=len,next=function(){var i,len;if(data.scripts&&data.scripts.length)for(i=0,len=data.scripts.length;len>i;i++)Util.globalEval(data.scripts[i]);callback&&callback(data)};if(!len)return void(next&&next());for(i=0;len>i;i++)Util.loadJs(data.js[i],BigPipe.ignoreDuplicate,next&&function(){--remaining||next()})};return{loadCss:loadCss,loadJs:loadJs}}var insertQueue=[],count=0,pagelets=[],currReqID=null,resourceChecked=!1,cache={},globalBigPipeLoadIndex=0;return{onPageletArrive:function(obj){resourceChecked||(Util.saveLoadedRes(),resourceChecked=!0),currReqID=obj.reqID,this.trigger("pageletarrive",obj);var pagelet=new PageLet(obj,function(){var item;if(count--,0===count)for(;item=pagelets.shift();)BigPipe.trigger("pageletinsert",pagelet,item.pageletData),item.loadJs(function(item){BigPipe.trigger("pageletdone",pagelet,item.pageletData)}(item))});pagelet.pageletData=obj,pagelets.push(pagelet),count++,pagelet.loadCss()},load:function(pagelets){function onPageArrive(data){if(void 0===data.reqID||data.reqID===pageletRequestID){var id=data.id;remaining++,containers[id]&&(data.container=containers[id]),data.extend=obj.extend}}var obj,i,id,url,container,args=[],currentPageUrl=location.href,containers={},pageletRequestID=globalBigPipeLoadIndex++,remaining=0;for(pagelets instanceof Array?obj={pagelets:pagelets}:(obj="string"==typeof pagelets?{pagelets:pagelets}:pagelets,pagelets=obj.pagelet||obj.pagelets,"string"==typeof pagelets&&(pagelets=pagelets.split(/\s*,\s*/))),i=pagelets.length-1;i>=0;i--)id=pagelets[i],args.push("pagelets[]="+id),container=obj.container&&obj.container[id]||obj.container,containers[id]=container;if(args.push("reqID="+pageletRequestID),BigPipe.on("pageletarrive",onPageArrive),obj.search&&args.push(obj.search),obj.param&&args.push(obj.param),url=obj.url?obj.url+(-1===obj.url.indexOf("?")?"?":"&")+args.join("&"):obj.search?"?"+args.join("&"):(location.search?location.search+"&":"?")+args.join("&"),BigPipe.on("pageletdone",function(pagelet,res){(void 0===res.reqID||res.reqID===pageletRequestID)&&(remaining--,0===remaining&&(BigPipe.off("pageletdone",arguments.callee),BigPipe.off("pageletarrive",onPageArrive),obj.cb&&obj.cb()))}),cache[obj.cacheID]){var requestCache=cache[obj.cacheID];pageletRequestID=requestCache.reqID,Util.globalEval(requestCache.content)}else Util.ajax(url,function(err,res){return err?obj.cb&&obj.cb(err):void(currentPageUrl===location.href&&(Util.globalEval(res),obj.cacheID&&(cache[obj.cacheID]={content:res,reqID:currReqID})))})}}}();Event.mixto(BigPipe),BigPipe.ignoreDuplicate=!0,window.BigPipe=BigPipe}(this);